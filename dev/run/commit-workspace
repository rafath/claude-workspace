#!/bin/bash

### Commits only "workspace" files with a standard message.
# Unstages all other changes first - re-stage them after if needed.
# Usage: dev/run/commit-workspace

set -e

WORKSPACE_DIR="dev/workspace"

# Step 1: Validate workspace exists
if [[ ! -d "$WORKSPACE_DIR" ]]; then
    echo "âŒ No workspace found at $WORKSPACE_DIR"
    exit 1
fi

# Step 2: Unstage everything first
echo "ğŸ“ Unstaging all files..."
git reset HEAD -- . >/dev/null 2>&1 || true

# Step 3: Stage workspace and config files
echo "ğŸ“ Staging workspace and config files..."
git add "$WORKSPACE_DIR" .claude/config/ .gitattributes

# Step 4: Show what will be committed
echo ""
echo "Files to commit:"
git diff --cached --name-only | sed 's/^/  /'
echo ""

# Step 5: Commit if there are staged changes
if git diff --cached --quiet; then
    echo "â„¹ No workspace changes to commit"
else
    read -p "Commit these files? [y/N] " -n 1 -r
    echo
    [[ $REPLY =~ ^[Yy]$ ]] || exit 0

    git commit -m "ğŸ“ Workspace files updated!"
    echo "âœ“ Workspace committed"
fi
